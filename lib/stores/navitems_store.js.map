{"version":3,"sources":["../../src/stores/navitems_store.js"],"names":[],"mappings":"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","file":"navitems_store.js","sourcesContent":["const assign      = require(\"react/lib/Object.assign\")\n  , EventEmitter  = require(\"events\").EventEmitter\n  , _             = require(\"lodash\");\n\nconst Ajax        = require(\"ajax-es6-module\");\n\nconst navItemsFcty = require(\"../factory/navitems_fcty\")\n\n//Flux\nconst NavitemsDispatcher = require(\"../dispatchers/navitems_dispatcher\")\n    , NavitemsAction     = require(\"../actions/navitems_actions\");\n\nlet navitems;\n\nlet fetched     = false;\nlet requestMade = false;\n\nfunction get_data(api, progress){\n  const ajaxManager = new Ajax(api);\n  // ajaxManager.addUrl(api);\n\n  return ajaxManager.fetch(progress)\n    .then((data)=>{\n      return data;\n    })\n    .catch((err)=>{\n    throw new Error(err);\n  });\n}\n\nconst store = {\n  api:\"\"\n  , progress:null\n  // <<<<<<<<<<<<<<<< Event management >>>>>>>>>>\n  , emitChange(event) {\n    this.emit(event);\n  }\n\n  , addChangeListener(event, callback) {\n    this.on(event, callback);\n  }\n\n  , removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  }\n\n  , _addItems(data){\n    // console.log(data)\n    navitems = navItemsFcty(data)\n  }\n\n  , _fetchData(){\n    get_data(this.api, this.progress).then((data)=>{\n      fetched  = true;\n      navitems = navItemsFcty(data);\n      this.emitChange(\"fetched\");\n    })\n  }\n\n  , _getLevels(){\n    return navitems.getLevels()\n  }\n\n  , getItem:(id)=>{\n    return navitems.findItem(id);\n  }\n\n  , getSubs:(id)=>{\n    return navitems.getSub(id);\n  }\n\n  , _getRoots(){\n    return navitems.getRoots();\n  }\n\n  , _isActive(id){\n    return navitems.findItem(id).active;\n  }\n\n  , prepForTouchNav(items){\n    return _.map(items, (item)=>{\n      return {\n          id    :item.id\n        , name  : item.title\n        , title : `Go to ${item.title}`\n        , href  : item.path\n        , active: item.active\n      }\n\n    })\n  }\n\n  , _progress(prog){\n    this.progress = prog;\n  }\n\n  , _setActive(id){\n    navitems.setActive(id);\n  }\n\n  , _setApi(api){\n    this.api = api;\n  }\n}\n\nconst NavitemsStore = assign({}, EventEmitter.prototype, store);\nNavitemsStore.setMaxListeners(0);\n\nconst registeredCallback = function(payload) {\n  var action = payload.action;\n  switch(action.type) {\n    case \"FETCH_DATA\":\n      if(action.progress) NavitemsStore._progress(action.progress)\n      NavitemsStore._fetchData();\n      NavitemsStore.emitChange(\"fetching\");\n      break;\n\n    case \"PRERENDER_DATA\":\n      NavitemsStore._addItems(action.data);\n      NavitemsStore.emitChange(\"prerender\");\n      break;\n\n    case \"SET_ACTIVE\":\n      NavitemsStore._setActive(action.id);\n      NavitemsStore.emitChange(\"active_set\");\n\n      break;\n\n    case \"SET_API\":\n      NavitemsStore._setApi(action.url);\n      NavitemsStore.emitChange(\"api_set\");\n\n      break;\n\n  }\n};\n\nNavitemsStore.dispatchToken = NavitemsDispatcher.register(registeredCallback);\nNavitemsStore.setMaxListeners(0);\n\nmodule.exports = NavitemsStore;\n"]}
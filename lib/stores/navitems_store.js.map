{"version":3,"sources":["../../src/stores/navitems_store.js"],"names":[],"mappings":"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","file":"navitems_store.js","sourcesContent":["const assign      = require(\"react/lib/Object.assign\")\n  , EventEmitter  = require(\"events\").EventEmitter\n  , _             = require(\"lodash\");\n\nconst Ajax        = require(\"ajax-es6-module\");\n\nconst navItemsFcty = require(\"../factory/navitems_fcty\")\n\n//Flux\nconst NavitemsDispatcher = require(\"../dispatchers/navitems_dispatcher\")\n    , NavitemsAction     = require(\"../actions/navitems_actions\");\n\nlet navitems;\n\nlet fetched     = false;\nlet requestMade = false;\n\nfunction get_data(api, progress){\n  const ajaxManager = new Ajax(api);\n  // ajaxManager.addUrl(api);\n\n  return ajaxManager.fetch(progress)\n    .then((data)=>{\n      return data;\n    })\n    .catch((err)=>{\n    throw new Error(err);\n  });\n}\n\nconst store = {\n  api:\"\"\n  , progress:null\n  // <<<<<<<<<<<<<<<< Event management >>>>>>>>>>\n  , emitChange(event) {\n    this.emit(event);\n  }\n\n  , addChangeListener(event, callback) {\n    this.on(event, callback);\n  }\n\n  , removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  }\n\n  , _addItems(data){\n    // console.log(data)\n    navitems = navItemsFcty(data)\n  }\n\n  , _fetchData(){\n    get_data(this.api, this.progress).then((data)=>{\n      fetched  = true;\n      navitems = navItemsFcty(data);\n      this.emitChange(\"fetched\");\n    })\n  }\n\n  , _getLevels(){\n    return navitems.getLevels()\n  }\n\n  , getItem:(id)=>{\n    return navitems.findItem(id);\n  }\n\n  , getSubs:(id)=>{\n    return navitems.getSub(id);\n  }\n\n  , _getRoots(){\n    return navitems.getRoots();\n  }\n\n  , _isActive(id){\n    return navitems.findItem(id).active;\n  }\n\n  , prepForTouchNav(items){\n    return _.map(items, (item)=>{\n      return {\n          id    :item.id\n        , name  : item.title\n        , title : `Go to ${item.title}`\n        , href  : item.path\n        , active: item.active\n      }\n\n    })\n  }\n\n  , _progress(prog){\n    this.progress = prog;\n  }\n\n  , _setActive(id){\n    navitems.setActive(id);\n  }\n\n  , _setApi(api){\n    this.api = api;\n  }\n}\n\nconst NavitemsStore = assign({}, EventEmitter.prototype, store);\nNavitemsStore.setMaxListeners(0);\n\nconst registeredCallback = function(payload) {\n  var action = payload.action;\n  switch(action.type) {\n    case \"FETCH_DATA\":\n      if(action.progress) NavitemsStore._progress(action.progress)\n      NavitemsStore._fetchData();\n      NavitemsStore.emitChange(\"fetching\");\n      break;\n\n    case \"PRERENDER_DATA\":\n      NavitemsStore._addItems(action.data);\n      NavitemsStore.emitChange(\"prerender\");\n      break;\n\n    case \"SET_ACTIVE\":\n      NavitemsStore._setActive(action.id);\n      NavitemsStore.emitChange(\"active_set\");\n\n      break;\n\n    case \"SET_API\":\n      NavitemsStore._setApi(action.url);\n      NavitemsStore.emitChange(\"api_set\");\n\n      break;\n\n  }\n};\n\nNavitemsStore.dispatchToken = NavitemsDispatcher.register(registeredCallback);\nNavitemsStore.setMaxListeners(0);\n\nmodule.exports = NavitemsStore;\n"]}